version: '3.8'

services:
  torgo:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: torgo_service
    ports:
      - "${API_PORT:-8080}:8080"
      - "${COMMON_SOCKS_PROXY_PORT:-9000}:9000"
      - "${COMMON_DNS_PROXY_PORT:-5300}:5300/tcp"
      - "${COMMON_DNS_PROXY_PORT:-5300}:5300/udp"
      - "${PRIVOXY_HTTP_PORT:-8118}:8118"
    environment:
      - TOR_INSTANCES=${TOR_INSTANCES:-3}
      - SOCKS_BASE_PORT_CONFIGURED=${SOCKS_BASE_PORT_CONFIGURED:-9050}
      - CONTROL_BASE_PORT_CONFIGURED=${CONTROL_BASE_PORT_CONFIGURED:-9160}
      - DNS_BASE_PORT_CONFIGURED=${DNS_BASE_PORT_CONFIGURED:-9200}
      - COMMON_SOCKS_PROXY_PORT=${COMMON_SOCKS_PROXY_PORT:-9000}
      - COMMON_DNS_PROXY_PORT=${COMMON_DNS_PROXY_PORT:-5300}
      - API_PORT=${API_PORT:-8080}
      - ROTATION_STAGGER_DELAY_SECONDS=${ROTATION_STAGGER_DELAY_SECONDS:-15}
      - HEALTH_CHECK_INTERVAL_SECONDS=${HEALTH_CHECK_INTERVAL_SECONDS:-45}
      - IP_CHECK_URL=${IP_CHECK_URL:-https://check.torproject.org/api/ip}
      - SOCKS_TIMEOUT_SECONDS=${SOCKS_TIMEOUT_SECONDS:-15}
      - DNS_TIMEOUT_SECONDS=${DNS_TIMEOUT_SECONDS:-5}
      - IP_DIVERSITY_CHECK_INTERVAL_SECONDS=${IP_DIVERSITY_CHECK_INTERVAL_SECONDS:-300}
      - IP_DIVERSITY_ROTATION_COOLDOWN_SECONDS=${IP_DIVERSITY_ROTATION_COOLDOWN_SECONDS:-900}
      - MIN_INSTANCES_FOR_IP_DIVERSITY_CHECK=${MIN_INSTANCES_FOR_IP_DIVERSITY_CHECK:-2}
      - AUTO_ROTATE_CIRCUIT_INTERVAL_SECONDS=${AUTO_ROTATE_CIRCUIT_INTERVAL_SECONDS:-3600}
      - AUTO_ROTATE_STAGGER_DELAY_SECONDS=${AUTO_ROTATE_STAGGER_DELAY_SECONDS:-30}
      - DNS_CACHE_ENABLED=${DNS_CACHE_ENABLED:-true}
      - DNS_CACHE_EVICTION_INTERVAL_SECONDS=${DNS_CACHE_EVICTION_INTERVAL_SECONDS:-300}
      - DNS_CACHE_DEFAULT_MIN_TTL_SECONDS=${DNS_CACHE_DEFAULT_MIN_TTL_SECONDS:-60}
      - DNS_CACHE_MIN_TTL_OVERRIDE_SECONDS=${DNS_CACHE_MIN_TTL_OVERRIDE_SECONDS:-0}
      - DNS_CACHE_MAX_TTL_OVERRIDE_SECONDS=${DNS_CACHE_MAX_TTL_OVERRIDE_SECONDS:-86400}
    restart: unless-stopped
